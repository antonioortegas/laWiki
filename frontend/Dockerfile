# Use node LTS
FROM node:18

ARG VITE_ENTRIES_API_HOST
ARG VITE_PICTURES_API_HOST
ARG VITE_USERS_API_HOST
ARG VITE_VERSIONS_API_HOST
ARG VITE_WIKIS_API_HOST
ARG VITE_TRANSLATION_API_HOST

ENV VITE_ENTRIES_API_HOST=${VITE_ENTRIES_API_HOST}
ENV VITE_PICTURES_API_HOST=${VITE_PICTURES_API_HOST}
ENV VITE_USERS_API_HOST=${VITE_USERS_API_HOST}
ENV VITE_VERSIONS_API_HOST=${VITE_VERSIONS_API_HOST}
ENV VITE_WIKIS_API_HOST=${VITE_WIKIS_API_HOST}
ENV VITE_TRANSLATION_API_HOST=${VITE_TRANSLATION_API_HOST}

# Install dependencies
WORKDIR /app
COPY package.json ./
RUN npm install

# Copy app source
COPY . .

# Expose port
EXPOSE 4173
EXPOSE 5173

# Build and start the app
RUN npm run build
CMD ["npm", "run", "preview"]